<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %} {% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    {% block links %}{% endblock %}
    <style>
        .dm-header {
            background-color: #e67e22;
            border-color: #e67e22;
        }
        {% block css %} {% endblock %}
    </style>
    {% block script_head %}{% endblock %}
</head>
<body>
<div class="container-fluid p-0 d-flex flex-column vh-100">
    <!-- Header -->
    <div class="dm-header screen-header p-3 d-flex justify-content-between align-items-center">
        <h4 class="m-0">TapNDine</h4>
        <span>Table #<button class="text-light" style="border: none; background-color: #e67e22;" id="table">12</button></span>
    </div>

    <!-- Content -->
    {% block body %}{% endblock %}

    <!-- Bottom Navigation -->
<!-- Bottom Navigation -->
<nav class="navbar-bottom py-2">
  <div class="container">
      <div class="d-flex justify-content-around text-center">
          <a href="/menu/home" class="footer nav-link d-flex flex-column align-items-center" data-index="0">
              <div class="navbar-icon"><i class="bi bi-book"></i></div>
              Menu
          </a>
          <a href="/menu/plate" class="footer nav-link text-dark d-flex flex-column align-items-center position-relative" data-index="1">
              <div class="navbar-icon"><i class="bi bi-basket"></i></div>
              My Plate
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="plate-badge">
                  0
              </span>
          </a>
          <a href="/menu/order" class="footer nav-link text-dark d-flex flex-column align-items-center" data-index="2">
              <div class="navbar-icon"><i class="bi bi-clock-history"></i></div>
              Order Status
          </a>
      </div>
  </div>
</nav>

</div>

<form>
    {% csrf_token %}
</form>

<!-- JavaScript Section -->
<script>
    function updatePlateBadge() {
        const plate = JSON.parse(localStorage.getItem('plate')) || [];
        let totalItems = 0;

        // Calculate total quantity of all items
        plate.forEach(item => {
            totalItems += item.qty;
        });

        // Update the badge
        const badge = document.getElementById('plate-badge');
        if (badge) {
            badge.textContent = totalItems;
            // Hide badge if there are no items
            badge.style.display = totalItems > 0 ? 'block' : 'none';
        }
    }
    var footer = document.querySelectorAll('.footer');
    Array.from(footer).forEach(tab=>{
        tab.addEventListener('click',()=>{
            sessionStorage.setItem('footer-index',tab.getAttribute('data-index'));
        });
    })
    function removeFooterActive(){
        Array.from(footer).forEach(tab=>tab.classList.remove('active'));
    }
    // Call this when page loads
    document.addEventListener('DOMContentLoaded', function () {
        updatePlateBadge();
        removeFooterActive();
        if(sessionStorage.getItem('footer-index')==undefined)sessionStorage.setItem('footer-index','0');
        Array.from(footer).forEach(tab=>{
            if(tab.getAttribute('data-index')==sessionStorage.getItem('footer-index')){
                tab.classList.add('active');
            }
        })
    });

    {% block script %}{% endblock %}
</script>
</body>
</html>